# 测试文档

## 目录

1. [测试概述](#测试概述)
2. [已测试项表格](#已测试项表格)
3. [未测试项清单](#未测试项清单)
4. [测试方案建议](#测试方案建议)
5. [测试优先级评估](#测试优先级评估)
6. [测试环境要求](#测试环境要求)
7. [测试覆盖率统计](#测试覆盖率统计)

---

## 测试概述

本文档记录了博客服务器项目的测试状态，包括已完成和未完成的测试项目，以及未来测试计划和优先级评估。测试分为多个类别：功能测试、性能测试、安全测试和集成测试。

---

## 已测试项表格


| 测试名称         | 测试方法 | 测试文件                           | 测试结果 | 测试日期   | 测试分类 |
| ---------------- | -------- | ---------------------------------- | -------- | ---------- | -------- |
| 用户注册成功     | 单元测试 | `src/services/auth_test.rs`        | ✅ 通过  | 2023-12-03 | 功能测试 |
| 用户名太短       | 单元测试 | `src/services/auth_test.rs`        | ✅ 通过  | 2023-12-03 | 功能测试 |
| 密码太短         | 单元测试 | `src/services/auth_test.rs`        | ✅ 通过  | 2023-12-03 | 功能测试 |
| 重复用户名       | 单元测试 | `src/services/auth_test.rs`        | ✅ 通过  | 2023-12-03 | 功能测试 |
| 获取用户列表     | 单元测试 | `src/services/auth_test.rs`        | ✅ 通过  | 2023-12-03 | 功能测试 |
| 按ID获取用户     | 单元测试 | `src/services/auth_test.rs`        | ✅ 通过  | 2023-12-03 | 功能测试 |
| 按用户名获取用户 | 单元测试 | `src/services/auth_test.rs`        | ✅ 通过  | 2023-12-03 | 功能测试 |
| 分页获取用户     | 单元测试 | `src/services/auth_test.rs`        | ✅ 通过  | 2023-12-03 | 功能测试 |
| 更新用户         | 单元测试 | `src/services/auth_test.rs`        | ✅ 通过  | 2023-12-03 | 功能测试 |
| 删除用户         | 单元测试 | `src/services/auth_test.rs`        | ✅ 通过  | 2023-12-03 | 功能测试 |
| 创建文章         | 单元测试 | `src/services/posts_test.rs`       | ✅ 通过  | 2023-12-03 | 功能测试 |
| 创建草稿文章     | 单元测试 | `src/services/posts_test.rs`       | ✅ 通过  | 2023-12-03 | 功能测试 |
| 创建特色文章     | 单元测试 | `src/services/posts_test.rs`       | ✅ 通过  | 2023-12-03 | 功能测试 |
| 创建隐藏文章     | 单元测试 | `src/services/posts_test.rs`       | ✅ 通过  | 2023-12-03 | 功能测试 |
| 更新文章         | 单元测试 | `src/services/posts_test.rs`       | ✅ 通过  | 2023-12-03 | 功能测试 |
| 密码哈希验证     | 单元测试 | `src/utils/crypto_pwd.rs`          | ✅ 通过  | 2023-12-03 | 安全测试 |
| 基本HTTP响应     | 集成测试 | `tests/simple_integration_test.rs` | ✅ 通过  | 2023-12-03 | 集成测试 |

---

## 未测试项清单

### 1. 认证与授权系统 (未开始 ❌)

- JWT令牌生成与验证
- 刷新令牌机制
- 权限控制中间件
- 基于角色的访问控制 (RBAC)
- 密码重置流程
- 邮箱验证流程

### 2. 文章管理系统 (未开始 ❌)

- 文章删除功能
- 文章搜索功能
- 文章分类关联
- 文章标签关联
- 文章评论系统
- 文章点赞/收藏功能

### 3. 分类管理系统 (未开始 ❌)

- 分类CRUD操作
- 分类层级结构
- 分类文章关联

### 4. 标签管理系统 (未开始 ❌)

- 标签CRUD操作
- 标签文章关联
- 标签自动推荐

### 5. 用户管理系统扩展 (未开始 ❌)

- 用户头像上传
- 用户资料更新
- 用户活动日志
- 用户封禁/解封

### 6. 邮件服务 (未开始 ❌)

- 邮件发送功能
- 邮件模板渲染
- 邮件队列管理
- 邮件发送失败重试

### 7. 文件上传服务 (未开始 ❌)

- 图片上传处理
- 文件类型验证
- 文件大小限制
- 文件存储管理

### 8. 实时通信功能 (未开始 ❌)

- WebSocket连接管理
- 消息广播
- 消息持久化
- 消息历史记录

### 9. 性能测试 (未开始 ❌)

- 并发用户请求
- 数据库查询优化
- API响应时间
- 负载测试

### 10. 安全测试 (未开始 ❌)

- SQL注入防护
- XSS攻击防护
- CSRF攻击防护
- 速率限制
- 敏感数据泄露检查

---

## 测试方案建议

### 1. 认证与授权系统测试

#### JWT令牌测试

**测试步骤:**

1. 模拟用户登录获取JWT令牌
2. 验证令牌格式和内容
3. 使用令牌访问受保护资源
4. 验证过期令牌被拒绝
5. 验证篡改令牌被拒绝

**预期结果:**

- 有效令牌可以访问受保护资源
- 无效令牌被拒绝访问
- 过期令牌触发刷新机制

**所需资源:**

- 测试用户账号
- 测试环境数据库
- 模拟受保护资源的API端点

#### 权限控制测试

**测试步骤:**

1. 创建不同角色的测试用户（管理员、普通用户、访客）
2. 尝试访问需要特定权限的资源
3. 验证权限不足时被拒绝
4. 验证权限足够时成功访问

**预期结果:**

- 只有具有足够权限的用户才能访问资源
- 权限不足的用户收到适当的错误响应

**所需资源:**

- 多个测试用户账号
- 不同权限级别的API端点
- 权限配置数据

### 2. 文章管理系统测试

#### 文章删除功能测试

**测试步骤:**

1. 创建测试文章
2. 发送删除请求
3. 验证文章已被删除
4. 尝试访问已删除文章
5. 验证返回适当错误

**预期结果:**

- 删除操作成功执行
- 已删除文章无法访问
- 删除操作记录在系统日志中

**所需资源:**

- 测试文章数据
- 删除权限的用户账号
- 测试数据库

#### 文章搜索功能测试

**测试步骤:**

1. 创建包含特定关键词的测试文章
2. 使用关键词搜索文章
3. 验证搜索结果包含相关文章
4. 测试不存在的关键词搜索
5. 测试空搜索查询

**预期结果:**

- 搜索结果包含相关文章
- 不存在的关键词返回空结果
- 空搜索返回适当错误或默认结果

**所需资源:**

- 多篇测试文章
- 搜索API端点
- 测试数据库

### 3. 分类管理系统测试

#### 分类CRUD测试

**测试步骤:**

1. 创建测试分类
2. 验证分类创建成功
3. 更新分类信息
4. 验证更新成功
5. 删除分类
6. 验证删除成功

**预期结果:**

- 分类CRUD操作正确执行
- 分类信息正确更新
- 分类正确删除

**所需资源:**

- 管理员权限账号
- 分类管理API端点
- 测试数据库

### 4. 性能测试

#### 并发请求测试

**测试步骤:**

1. 设置测试环境（预热数据库等）
2. 模拟多个并发用户请求
3. 记录响应时间和成功率
4. 逐步增加并发数
5. 分析性能拐点

**预期结果:**

- 确定系统可处理的并发用户数
- 发现性能瓶颈
- 提供性能优化建议

**所需资源:**

- 负载测试工具（如JMeter或k6）
- 高性能测试环境
- 监控工具

---

## 测试优先级评估


| 测试类别       | 优先级 | 紧急程度 | 理由                               |
| -------------- | ------ | -------- | ---------------------------------- |
| 认证与授权系统 | 高     | 高       | 系统安全核心，直接影响用户数据安全 |
| 文章删除功能   | 高     | 中       | 核心功能缺失，影响内容管理完整性   |
| 权限控制测试   | 高     | 高       | 防止越权访问，保障系统安全         |
| 分类管理系统   | 中     | 中       | 内容组织重要，但已有基本功能       |
| 文章搜索功能   | 中     | 低       | 提升用户体验，但非核心功能         |
| 标签管理系统   | 中     | 低       | 内容组织辅助功能，优先级较低       |
| 邮件服务测试   | 高     | 中       | 用户体验重要，影响用户注册流程     |
| 文件上传服务   | 中     | 低       | 辅助功能，不是核心流程             |
| 性能测试       | 中     | 中       | 确保系统稳定性，但当前功能较简单   |
| 安全测试       | 高     | 高       | 防止安全漏洞，保护用户和系统数据   |

---

## 测试环境要求

### 1. 基础环境

**开发环境:**

- 操作系统: Windows 10/11, macOS, 或 Linux
- Rust: 最新稳定版 (1.70+)
- 数据库: PostgreSQL 13+ (生产) / SQLite (测试)
- Git: 版本控制

**测试环境变量:**

```bash
DATABASE_URL=sqlite::memory:  # 测试环境使用内存数据库
JWT_SECRET=test_secret_key    # 测试用JWT密钥
LOG_LEVEL=debug              # 测试时启用详细日志
```

### 2. 功能测试环境

**认证与授权测试:**

- 测试数据库（包含预设用户数据）
- 多个测试账号（不同权限级别）
- JWT令牌生成和验证工具

**文章管理测试:**

- 预设测试文章数据
- 不同状态的文章（草稿、发布、隐藏）
- 文章分类和标签数据

### 3. 性能测试环境

**硬件要求:**

- CPU: 4核心或以上
- 内存: 8GB或以上
- 磁盘: SSD存储
- 网络: 稳定的网络连接

**软件要求:**

- 负载测试工具（JMeter, k6, 或 work）
- 监控工具（htop, Prometheus, 或类似工具）
- 性能分析工具（perf, 或 Rust专用工具）

### 4. 安全测试环境

**工具要求:**

- SQL注入测试工具（SQLMap）
- CSRF测试插件（浏览器扩展）
- 密码强度测试工具

**数据要求:**

- 包含敏感信息的测试数据（用于验证泄露防护）
- 弱密码测试用例
- 特殊字符和SQL注入尝试数据

---

## 测试覆盖率统计

### 当前覆盖率

**总体测试覆盖率:** 约30%

**模块覆盖率:**


| 模块              | 覆盖率 | 测试类型      | 备注                 |
| ----------------- | ------ | ------------- | -------------------- |
| 认证服务 (auth)   | 80%    | 单元测试      | 覆盖主要用户管理功能 |
| 文章服务 (posts)  | 60%    | 单元测试      | 覆盖基本CRUD操作     |
| 加密工具 (crypto) | 90%    | 单元测试      | 密码哈希和验证       |
| 集成测试          | 5%     | 集成测试      | 仅有基础HTTP响应测试 |
| API端点           | 10%    | 集成测试      | 大部分端点未测试     |
| 中间件            | 0%     | 单元/集成测试 | 未测试               |

### 目标覆盖率

**短期目标 (1个月内):**

- 认证服务: 90% → 增加权限和JWT测试
- 文章服务: 80% → 增加搜索、删除和关联测试
- 集成测试: 30% → 覆盖主要API端点
- API端点: 50% → 覆盖核心功能端点
- 中间件: 40% → 测试认证和权限中间件

**中期目标 (3个月内):**

- 认证服务: 95% → 覆盖边界情况
- 文章服务: 90% → 覆盖复杂查询和关联
- 集成测试: 60% → 覆盖主要用户流程
- API端点: 80% → 覆盖大部分端点
- 中间件: 70% → 覆盖所有中间件
- 新增: 性能测试和安全测试覆盖率 60%

**长期目标 (6个月内):**

- 总体测试覆盖率: 85%+
- 所有核心模块覆盖率: 90%+
- 完整的端到端测试覆盖
- 自动化性能基准测试
- 全面安全测试套件

---

## 执行测试的命令

### 运行所有测试

```bash
cargo test
```

### 只运行单元测试

```bash
cargo test --lib
```

### 运行特定模块测试

```bash
# 认证服务测试
cargo test auth_test

# 文章服务测试
cargo test posts_test
```

### 生成测试覆盖率报告

```bash
# 安装工具
cargo install cargo-tarpaulin

# 生成覆盖率报告
cargo tarpaulin --out Html
```

---

## 测试自动化

### 持续集成建议

1. **GitHub Actions工作流**:

   - 每次PR和合并时自动运行测试
   - 分单元测试和集成测试为不同阶段
   - 失败时阻止合并
2. **测试报告**:

   - 自动生成覆盖率报告
   - 将覆盖率报告上传到代码覆盖率服务
   - 设置覆盖率阈值要求
3. **性能基准**:

   - 设置性能基准测试
   - 在PR中比较性能变化
   - 在性能显著下降时发出警告

### 本地开发建议

1. **预提交钩子**:

   - 使用`pre-commit`工具在提交前运行测试
   - 确保本地测试通过后再提交
2. **IDE集成**:

   - 配置IDE一键运行测试
   - 显示测试覆盖率
   - 实时运行测试
3. **测试数据管理**:

   - 使用Docker或测试容器管理测试环境
   - 自动清理测试数据
   - 确保测试隔离

---

## 总结

当前项目已有基础的用户和文章管理测试，但仍有大量功能未覆盖。优先实现认证与授权系统的完整测试，这对于系统安全至关重要。之后逐步扩展到其他核心功能，如文章删除、搜索等。中期目标是建立全面的集成测试和API测试，长期目标是实现高覆盖率和自动化性能、安全测试。
